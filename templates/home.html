{% set active_page = "home" %}
{% extends "base.html" %}

{% block title %}Login{%endblock%}
{% block content %}
<!-- Most of Following Code Block Generated By ChatGPT -->
<nav class="navbar navbar-expand-lg navbar-light">
    <div class="container">
      <a class="navbar-brand homenavbar nav-left-buttons" href="/home">Home</a>
      <a class="navbar-brand nav-left-buttons mr-auto" href="/newpost">New Post</a>
      <div class=" justify-content-end">
        <ul class="navbar-nav">
          <li class="nav-item ml-auto">
            <a class="navbar-brand" href="/logout">Logout {{u.username}}</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
   <!-- End ChatGPT Code -->
<div class="home-flashes">
    {% with messages = get_flashed_messages() %}
        {%if messages %}
            {%for message in messages %}
                <p class="post-flash">{{message}}</p>
            {% endfor%}
        {%endif%}
    {% endwith %}
</div>
<div class="container">
    <div class="row">
        <div class="col-md-2 sortby">
            <h4>Sort By:</h4>
            <br>
            <a class="btn btn-default" href="/home/recent">Most Recent</a>
            <br>
            <a class="btn btn-default" href="/home/popular">Popular</a>
        </div>
        
        <!-- Post code starts here -->
        <div class="col-md-7">
            {% for post in posts %}
                <div class="post" id="post{{post.id}}">
                    <h2 class="post-title">{{ post.title }}</h2>
                    <div class="row">
                        <div class="col-md-4">
                            <p class="post-info">Posted by {{ post.user_id }}</p>
                            <p>{{ post.time }}</p>
                            <p class="post-stats">{{ post.upvotes|length }} upvotes</p>
                            <!--print upvote button red if user has already upvoted that post-->
                            {%if u in post.upvoters%} 
                                <button type="submit" class="btn btn-primary disabled-submit-button">Upvote</button>
                            {%else%}
                                <form method="POST" action="/upvote">
                                    <input type="hidden" value="{{ post.id }}" name="post-id">
                                    <button type="submit" class="btn btn-primary upvote-btn">Upvote</button>
                                </form>
                            {%endif%}
                        </div>
                        <div class="col-md-8">
                            <div class="post-content">
                                <p>{{ post.content }}</p>
                            </div>
                        </div>  
                    </div>
                </div>
            {% endfor %}
        </div>
        <!-- Post code ends here -->
        
        <div class="col-md-3 categories">
            <h3>Categories</h3>
            <ul>
                <li><a href="/home/academics">Academics</a></li>
                <li><a href="/home/social">Social</a></li>
                <li><a href="/home/teachers">Teachers</a></li>
                <li><a href="/home/athletics">Athletics</a></li>
                <li><a href="/home/other">Other</a></li>
            </ul>
        </div>
    </div>
    <hr>
</div>

{%endblock%}